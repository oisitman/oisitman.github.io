<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Finnish Trainer — Local</title> <script src="https://cdn.tailwindcss.com"></script> <style>.card{@apply rounded-2xl shadow-lg p-6 bg-white}.btn{@apply rounded-2xl px-4 py-2 shadow bg-gray-900 text-white hover:opacity-90 disabled:opacity-50}.btn-ghost{@apply rounded-2xl px-3 py-2 text-gray-700 hover:bg-gray-100}.pill{@apply inline-flex items-center gap-2 text-xs font-medium rounded-full px-3 py-1 bg-gray-100}.input{@apply w-full rounded-xl border border-gray-300 px-3 py-2}.select{@apply w-full rounded-xl border border-gray-300 px-3 py-2}.link{@apply text-blue-700 underline}table thead th{@apply text-xs uppercase tracking-wide text-gray-500}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}</style> </head> <body class="bg-gray-50 text-gray-900"> <div id="liveRegion" class="sr-only" aria-live="polite"></div> <div class="max-w-5xl mx-auto p-4 sm:p-8"> <header class="mb-6 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4"> <div> <h1 class="text-3xl font-bold">Finnish Trainer</h1> <p class="text-sm text-gray-600">Study words, phrases, conjugations, and numbers. </p> </div> <div class="flex items-center gap-2"> <button id="exportBtn" class="btn" title="Export your data as JSON">Export</button> <label class="btn cursor-pointer" title="Import a JSON deck exported by this app"> Import <input type="file" id="importFile" accept="application/json" class="hidden"> </label> </div> </header> <button id="infoButton" class="fixed top-4 right-4 z-40 flex h-11 w-11 items-center justify-center rounded-full border border-gray-200 bg-white/80 text-gray-700 shadow-lg backdrop-blur hover:bg-white focus:outline-none focus:ring-2 focus:ring-gray-400" aria-haspopup="dialog" aria-controls="infoOverlay" aria-expanded="false"> <span class="sr-only">Show usage information</span> <span class="text-lg font-semibold">i</span> </button> <div id="infoOverlay" class="hidden fixed inset-0 z-30 flex items-start justify-end bg-black/40 p-4 sm:p-8"> <article id="infoPanel" class="relative w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl" role="dialog" aria-modal="true" aria-labelledby="infoPanelTitle" aria-describedby="infoPanelBody" tabindex="-1"> <button id="infoClose" class="absolute right-3 top-3 rounded-full bg-gray-100 px-2 py-1 text-sm text-gray-500 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300" aria-label="Close usage information">✕</button> <h2 id="infoPanelTitle" class="text-xl font-semibold text-gray-900">How to use Finnish Trainer</h2> <p class="mt-3 text-sm text-gray-600">Finnish Trainer keeps everything in your browser, so you can build personal decks and pick them up next time by importing what you exported.</p> <div id="infoPanelBody" class="mt-4 space-y-3 text-sm text-gray-700"> <section> <h3 class="font-semibold text-gray-900">Decks &amp; cards</h3> <p>Choose a deck from the dropdown, or tap <strong>+ Deck</strong> to start a new one. Add new words or phrases through the “Add a new card” section — include hints or mark verbs to manage conjugations.</p> </section> <section> <h3 class="font-semibold text-gray-900">Study modules</h3> <p>Switch between Flashcards, Multiple Choice, Typing, or Conjugation modes to practice in different ways. Use the direction and subset controls to tailor each session.</p> </section> <section> <h3 class="font-semibold text-gray-900">Import &amp; export</h3> <p>Import ready-made decks with the <strong>Import</strong> button (JSON exported by this app). After studying or editing, press <strong>Export</strong> to download your updated deck for the next session or to share with friends.</p> </section> </div> </article> </div> <main class="grid grid-cols-1 lg:grid-cols-3 gap-6"> <section class="card lg:col-span-1"> <h2 class="text-xl font-semibold mb-4">Decks</h2> <div class="flex items-center gap-2 mb-4"> <select id="deckSelect" class="select"></select> <button id="newDeckBtn" class="btn-ghost" title="Create a new deck">+ Deck</button> <button id="delDeckBtn" class="btn-ghost" title="Delete current deck">🗑</button> </div> <div class="space-y-2 mb-6"> <div class="pill">Cards in deck: <span id="cardCount" class="font-semibold">0</span> </div> <div class="pill">Due now: <span id="dueCount" class="font-semibold">0</span> </div> <div class="pill">New: <span id="newCount" class="font-semibold">0</span> </div> <div class="pill">Reviewing: <span id="reviewCount" class="font-semibold">0</span> </div> <div class="pill">Learned: <span id="learnedCount" class="font-semibold">0</span> </div> </div> <details class="mb-4"> <summary class="font-semibold cursor-pointer">Add a new card</summary> <div class="mt-3 space-y-2"> <input id="finnishInput" class="input" placeholder="Finnish (e.g., 'Huomenta')"> <input id="englishInput" class="input" placeholder="English meaning (e.g., 'Good morning')"> <input id="hintInput" class="input" placeholder="Hint / example / notes (optional)"> <div class="flex flex-wrap items-center gap-2"> <label class="pill"><input id="isPhrase" type="checkbox" class="mr-2"> Phrase/Sentence</label> <label class="pill"><input id="isVerb" type="checkbox" class="mr-2"> Verb</label> </div> <div id="verbEditor" class="hidden border rounded-xl p-3"> <div class="text-sm font-semibold mb-2">Conjugations (present tense)</div> <div class="grid sm:grid-cols-2 gap-2 mb-2"> <div> <label class="text-xs text-gray-500">Meaning (English)</label> <input id="verbMeaningInput" class="input mt-1" placeholder="e.g., 'to be'"> </div> </div> <div class="overflow-x-auto"> <table class="w-full text-left border rounded-xl overflow-hidden"> <thead class="bg-gray-50"> <tr> <th class="p-2">Persoonapronomini</th> <th class="p-2">Form</th> </tr> </thead> <tbody id="verbFormsBody"></tbody> </table> </div> <p class="text-xs text-gray-500 mt-2">Tip: If you leave some forms blank and the verb is supported internally (e.g., <em>olla</em>), those forms will be filled from the built‑in table in study mode.</p> </div> <button id="addCardBtn" class="btn">Add</button> </div> </details> <details> <summary class="font-semibold cursor-pointer">Cards in current deck</summary> <div id="cardList" class="mt-3 divide-y"></div> </details> </section> <section class="card lg:col-span-2"> <div class="flex flex-wrap items-center justify-between gap-3 mb-4"> <h2 class="text-xl font-semibold">Study</h2> <div class="flex flex-wrap items-center gap-2"> <select id="modeSelect" class="select"> <option value="flash">Flashcards</option> <option value="mcq">Multiple choice</option> <option value="type">Type the answer</option> <option value="conj">Conjugation</option> <option value="numbers">Numbers</option> </select> <select id="directionSelect" class="select" title="Prompt direction"> <option value="fi-en">Finnish → English</option> <option value="en-fi">English → Finnish</option> </select> <select id="subsetSelect" class="select" title="Limit which cards appear"> <option value="active">Active cards</option> <option value="verbs">Verbs only</option> <option value="phrases">Phrases only</option> <option value="new">New cards</option> <option value="review">Due reviews</option> <option value="suspended">Suspended only</option> <option value="all">All cards (incl. suspended)</option> </select> <button id="shuffleBtn" class="btn-ghost">Shuffle</button> <button id="suspendBtn" class="btn-ghost" title="Suspend or resume current card">Suspend</button> </div> </div> <div id="studyArea" class="space-y-4"> <div id="flashCard" class="border-2 border-dashed rounded-2xl p-8 text-center hidden"> <div class="text-sm text-gray-500 mb-1" id="fcLabel">Finnish</div> <div class="text-3xl font-bold leading-snug" id="fcPrompt">—</div> <div class="mt-4 space-x-2"> <button id="revealBtn" class="btn">Reveal</button> <button id="speakBtn" class="btn-ghost" title="Speak">🔊</button> </div> <div id="fcAnswerWrap" class="hidden mt-6"> <div class="text-sm text-gray-500 mb-1">Answer</div> <div class="text-2xl" id="fcAnswer">—</div> <div class="mt-2 text-gray-600" id="fcHint"></div> <div class="mt-4 flex flex-wrap gap-2"> <button class="btn" data-grade="again">Again</button> <button class="btn" data-grade="hard">Hard</button> <button class="btn" data-grade="good">Good</button> <button class="btn" data-grade="easy">Easy</button> </div> </div> </div> <div id="mcq" class="hidden"> <div class="text-sm text-gray-500 mb-1" id="mcqLabel">Finnish</div> <div class="text-3xl font-bold leading-snug" id="mcqPrompt">—</div> <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3" id="mcqOptions"></div> <div id="mcqFeedback" class="mt-3" role="status" aria-live="polite"></div> </div> <div id="type" class="hidden"> <div class="text-sm text-gray-500 mb-1" id="typeLabel">Finnish</div> <div class="text-3xl font-bold leading-snug" id="typePrompt">—</div> <div class="mt-4 flex gap-2"> <input id="typeInput" class="input" placeholder="Type your answer"> <button id="typeCheckBtn" class="btn">Check👀</button> </div> <div id="typeFeedback" class="mt-3" role="status" aria-live="polite"></div> </div> <div id="conj" class="hidden"> <div class="grid sm:grid-cols-2 gap-3 mb-3"> <div> <label class="text-sm text-gray-500">Verb (from current deck)</label> <div id="conjVerbName" class="pill mt-1">—</div> </div> <div> <label class="text-sm text-gray-500">Meaning (English)</label> <input id="conjMeaning" class="input mt-1" placeholder="e.g., 'to be'"> </div> </div> <div class="overflow-x-auto"> <table class="w-full text-left border rounded-xl overflow-hidden"> <thead class="bg-gray-50"> <tr> <th class="p-2">Persoonapronomini</th> <th class="p-2">Form</th> <th class="p-2">Status</th> </tr> </thead> <tbody id="conjRows"></tbody> </table> </div> <div class="mt-3 flex gap-2 items-center"> <button id="conjCheck" class="btn">Check👀</button> <button id="conjReveal" class="btn-ghost">Reveal</button> <div id="conjFeedback" class="text-sm text-gray-700" role="status" aria-live="polite"></div> </div> </div> <div id="numbers" class="hidden"> <div class="grid sm:grid-cols-3 gap-3 mb-3"> <div> <label class="text-sm text-gray-500">Mode</label> <select id="numMode" class="select mt-1"> <option value="digits-fi">Digits → Finnish</option> <option value="fi-digits">Finnish → Digits</option> <option value="ord-digits">Ordinal (fi → digits)</option> <option value="digits-ord">Ordinal (digits → fi)</option> </select> </div> <div class="sm:col-span-2"> <label class="text-sm text-gray-500">Range</label> <select id="numRange" class="select mt-1"> <option value="0-10">0–10</option> <option value="11-19">11–19</option> <option value="tens">Tens (20,30,…,90)</option> <option value="21-99">21–99</option> <option value="100-999">100–999</option> <option value="1000">1000</option> <option value="1e6">1 000 000</option> <option value="1e9">1 000 000 000</option> </select> </div> </div> <div class="flex items-center gap-3 mb-2"> <div class="text-sm text-gray-500">Prompt</div> <button id="numSpeak" class="btn-ghost" title="Speak">🔊</button> </div> <div class="text-3xl font-bold leading-snug" id="numPrompt">—</div> <div class="mt-4 flex gap-2"> <input id="numInput" class="input" placeholder="Type your answer"> <button id="numCheck" class="btn">Check👀</button> <button id="numReveal" class="btn-ghost">Reveal</button> </div> <div id="numFeedback" class="mt-3" role="status" aria-live="polite"></div> </div> <div id="emptyState" class="hidden text-center text-gray-600 border border-dashed rounded-2xl p-6"> No cards match your current filters. Try switching decks or changing the subset. </div> </div> <div id="progressPanel" class="rounded-2xl border border-gray-200 bg-gray-50 p-4"> <div class="flex flex-wrap items-center justify-between gap-4 mb-4"> <h3 class="text-lg font-semibold">Progress</h3> <div class="flex flex-wrap gap-3 text-sm"> <div class="pill bg-white border">Reviews today: <span id="reviewsToday" class="font-semibold">0</span> </div> <div class="pill bg-white border">Accuracy: <span id="accuracyToday" class="font-semibold">—</span> </div> <div class="pill bg-white border">Longest streak: <span id="longestStreak" class="font-semibold">0</span> days</div> </div> </div> <div> <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Last 7 days</div> <div id="progressChart" class="grid grid-cols-7 gap-2 h-24 items-end"></div> </div> </div> </section> </main> <footer class="mt-8 text-sm text-gray-500 flex items-center gap-2"> <p>🇫🇮 © 2025 Ogulcan, made with ❤️</p> <span id="testStatus" class="pill ml-auto"></span> </footer> </div> <script>function numberToFinnishCardinal(e){if(e<0||e>1e9)return String(e);if(e<10)return ONES[e];if(e<20)return TEENS[e-10];if(e<100){const n=Math.floor(e/10),t=e%10;return TENS[n]+(t?ONES[t]:"")}if(e<1e3){const n=Math.floor(e/100),t=e%100,r=1===n?HUNDRED:ONES[n].replace("yksi","yksi").replace(/$/,"")+"sataa";return 0===t?r:r+numberToFinnishCardinal(t)}return 1e3===e?"tuhat":1e6===e?"miljoona":1e9===e?"miljardi":String(e)}function numberToFinnishOrdinal(e){if(ORD_BASE[e])return ORD_BASE[e];if(e>10&&e<20){return TEENS[e-10].replace("toista","toista").replace("toista","toista").replace("yksi","yhde").replace("kaksi","kahde").replace("kolme","kolman").replace("nelj\xe4","nelj\xe4n").replace("viisi","viiden").replace("kuusi","kuudennen")}if(e%10==0&&e>=20&&e<100){return numberToFinnishCardinal(e).replace("kymment\xe4","kymmenes")}if(e>20&&e<100){const n=e%10;return numberToFinnishOrdinal(10*Math.floor(e/10))+numberToFinnishOrdinal(n)}return String(e)}function speak(e){try{const n=new SpeechSynthesisUtterance(e);n.lang="fi-FI",speechSynthesis.speak(n)}catch{}}function refreshDecks(){rebuildConjugations(),deckSelect.innerHTML="",Object.keys(DB.decks).forEach(e=>{const n=el("option","",e);n.value=e,n.selected=e===currentDeckName,deckSelect.appendChild(n)}),refreshCounts(),renderCardList(),reshuffle(),renderStudy(),renderProgress()}function refreshCounts(){const e=DB.decks[currentDeckName]||[];cardCount.textContent=e.length;const n=DB.stats[currentDeckName]||{},t=Date.now();let r=0,s=0,a=0;e.forEach((e,i)=>{if(e?.suspended)return;const o=n[i];o?o.due<=t?(r+=1,a+=1):a+=1:s+=1});const i=Object.values(n).filter(e=>(e?.ef||0)>2.4&&(e?.rep||0)>=3).length;learnedCount.textContent=i,dueCount.textContent=r,newCount.textContent=s,reviewCount.textContent=a}function renderCardList(){const e=DB.decks[currentDeckName]||[];cardList.innerHTML="",e.forEach((e,n)=>{const t=el("div","py-2 flex items-start justify-between gap-2"),r=el("div"),s=[e.phrase?"sentence":null,e.verb?"verb":null,e.suspended?"suspended":null].filter(Boolean);r.appendChild(el("div","font-medium",`${e.fi}${s.length?" \u2022 "+s.join(", "):""}`)),r.appendChild(el("div","text-sm text-gray-600",e.en));const a=e.verb?e.conj?.meaning||getBuiltInConj(e.fi)?.meaning:"";a&&r.appendChild(el("div","text-xs text-gray-500 italic",`Meaning: ${a}`));const i=e.example||e.hint;i&&r.appendChild(el("div","text-xs text-gray-500",i));const o=el("div","flex items-center gap-2"),c=el("button","btn-ghost","\ud83d\udd0a");c.onclick=()=>speak(e.fi);const l=el("button","btn-ghost",e.suspended?"Resume":"Suspend");l.onclick=()=>{e.suspended=!e.suspended,saveDB(),announce(`Card ${e.fi} ${e.suspended?"suspended":"resumed"}`),refreshCounts(),renderCardList(),reshuffle(),renderStudy()};const d=el("button","btn-ghost","\ud83d\uddd1");d.onclick=()=>{DB.decks[currentDeckName].splice(n,1);const e=DB.stats[currentDeckName]||{},t={};DB.decks[currentDeckName].forEach((r,s)=>{const a=s>=n?s+1:s;e[a]&&(t[s]=e[a])}),DB.stats[currentDeckName]=t,saveDB(),refreshDecks()},o.append(c,l,d),t.append(r,o),cardList.appendChild(t)})}function buildVerbEditorRows(){verbFormsBody.innerHTML="",PRONOUNS.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`<td class="p-2">${e}</td><td class="p-2"><input class="input w-full" data-vform="${e}"></td>`,verbFormsBody.appendChild(n)})}function getVerbPrefillData(e){const n=(e||"").trim().toLowerCase();if(!n)return null;const t=(DB.decks[currentDeckName]||[]).find(e=>(e.fi||"").trim().toLowerCase()===n&&e.conj),r=getBuiltInConj(e);return t?.conj?{meaning:t.conj.meaning||r?.meaning||"",pronouns:r?.pronouns||PRONOUNS,forms:{...r?.forms||{},...t.conj.forms||{}}}:r?{meaning:r.meaning||"",pronouns:r.pronouns||PRONOUNS,forms:{...r.forms||{}}}:null}function prefillVerbEditor(){const e=getVerbPrefillData(finnishInput.value);e&&(!verbMeaningInput.value.trim()&&e.meaning&&(verbMeaningInput.value=e.meaning),e.pronouns.forEach(n=>{const t=document.querySelector(`[data-vform="${n}"]`);t&&!t.value.trim()&&e.forms?.[n]&&(t.value=e.forms[n])}))}function normalizeCard(e){return e?(e.phrase&&!e.example&&e.hint&&(e.example=e.hint),e.verb&&e.conj&&!Array.isArray(e.conj.pronouns)&&(e.conj.pronouns=PRONOUNS),e.suspended=!!e.suspended,e):e}function normalizeAllDecks(){Object.values(DB.decks||{}).forEach(e=>{(e||[]).forEach(normalizeCard)}),rebuildConjugations(),ensureHistory()}function ensureHistory(){DB.history=DB.history||{},DB.history.daily=DB.history.daily||{},DB.history.streak=Number.isFinite(DB.history.streak)?DB.history.streak:0,DB.history.longestStreak=Number.isFinite(DB.history.longestStreak)?DB.history.longestStreak:0,DB.history.lastReviewDate=DB.history.lastReviewDate||null}function recordReview(e){ensureHistory();const n=dayKey(),t=DB.history.daily;if(t[n]=t[n]||{reviews:0,correct:0},t[n].reviews+=1,"again"!==e&&(t[n].correct+=1),DB.history.lastReviewDate!==n){if(DB.history.lastReviewDate){const e=diffInDays(parseDay(DB.history.lastReviewDate),parseDay(n));DB.history.streak=1===e?DB.history.streak+1:1}else DB.history.streak=1;DB.history.lastReviewDate=n,DB.history.streak>DB.history.longestStreak&&(DB.history.longestStreak=DB.history.streak)}}function renderProgress(){if(!reviewsToday||!accuracyToday||!progressChart)return;ensureHistory();const e=DB.history.daily,n=e[dayKey()]||{reviews:0,correct:0};reviewsToday.textContent=n.reviews,accuracyToday.textContent=n.reviews?`${Math.round(n.correct/n.reviews*100)}%`:"\u2014",longestStreak.textContent=DB.history.longestStreak||0;const t=[];for(let n=6;n>=0;n--){const r=new Date;r.setDate(r.getDate()-n);const s=dayKey(r),a=e[s]||{reviews:0,correct:0};t.push({key:s,label:r.toLocaleDateString(void 0,{weekday:"short"}),stats:a})}const r=Math.max(1,...t.map(e=>e.stats.reviews));progressChart.innerHTML="",t.forEach(e=>{const n=document.createElement("div"),t=e.stats.reviews?Math.max(10,Math.round(e.stats.reviews/r*100)):6;n.className="relative w-full rounded-lg "+(e.stats.reviews?"bg-blue-500":"bg-blue-100"),n.style.height=`${t}%`,n.title=`${e.label}: ${e.stats.reviews} review${1===e.stats.reviews?"":"s"} (${e.stats.correct} correct)`,n.setAttribute("aria-label",`${e.label} had ${e.stats.reviews} reviews`);const s=document.createElement("div");s.className="absolute inset-x-0 top-full mt-1 text-xs text-center text-gray-500",s.textContent=e.label[0],n.appendChild(s),progressChart.appendChild(n)})}function announce(e){liveRegion&&(liveRegion.textContent="",requestAnimationFrame(()=>{liveRegion.textContent=e}))}function speakCurrentCard(){currentStudyCard?.card&&(speak(currentStudyCard.card.fi),announce(`Speaking ${currentStudyCard.card.fi}`))}function gradeCurrentCard(e){if(!currentStudyCard)return!1;DB.stats[currentDeckName]=DB.stats[currentDeckName]||{},DB.stats[currentDeckName][currentStudyCard.idx]=sm2Update(DB.stats[currentDeckName][currentStudyCard.idx],e),recordReview(e),saveDB(),refreshCounts(),renderCardList(),renderProgress();return announce(`Marked card ${{again:"Again",hard:"Hard",good:"Good",easy:"Easy"}[e]||e}`),renderStudy(),!0}function toggleSuspendCurrent(){if(!currentStudyCard?.card)return;currentStudyCard.card.suspended=!currentStudyCard.card.suspended;const e=currentStudyCard.card.suspended?"suspended":"resumed";saveDB(),refreshCounts(),renderCardList(),reshuffle(),announce(`Card ${e}`),renderStudy()}function cardMatchesSubset(e,n,t,r,s){if(!e)return!1;const a=r[n],i=!!e.suspended,o=a&&a.due<=s;switch(t){case"verbs":return!i&&!!e.verb;case"phrases":return!i&&!!e.phrase;case"new":return!i&&!a;case"review":return!i&&!!a&&o;case"suspended":return i;case"all":return!0;default:return!i}}function shuffleInPlace(e){for(let n=e.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}}function reshuffle(){const e=DB.decks[currentDeckName]||[],n=DB.stats[currentDeckName]||{},t=Date.now(),r=[],s=[],a=[],i=subsetSelect?subsetSelect.value:"active";e.forEach((e,o)=>{if(!cardMatchesSubset(e,o,i,n,t))return;if("suspended"===i)return void a.push(o);const c=n[o];c?c.due<=t?r.push(o):a.push(o):s.push(o)}),shuffleInPlace(r),shuffleInPlace(s),shuffleInPlace(a),currentOrder=[...r,...s,...a],currentIndex=0}function pickCard(){const e=DB.decks[currentDeckName]||[];if(!e.length)return null;currentIndex>=currentOrder.length&&reshuffle();const n=currentOrder[currentIndex++];return{idx:n,card:e[n]}}function sm2Update(e,n){e||(e={rep:0,ef:2.5,interval:0,due:Date.now()});const t={again:1,hard:3,good:4,easy:5}[n]||3;return t<3?(e.rep=0,e.interval=1):(e.rep+=1,1===e.rep?e.interval=1:2===e.rep?e.interval=6:e.interval=Math.round(e.interval*e.ef)),e.ef=Math.max(1.3,e.ef+(.1-(5-t)*(.08+.02*(5-t)))),e.due=Date.now()+24*e.interval*60*60*1e3,e}function pickNumber(e){switch(e){case"0-10":return Math.floor(11*Math.random());case"11-19":return 11+Math.floor(9*Math.random());case"tens":return 20+10*Math.floor(8*Math.random());case"21-99":return[20,30,40,50,60,70,80,90][Math.floor(8*Math.random())]+(1+Math.floor(8*Math.random()));case"100-999":return 100+Math.floor(900*Math.random());case"1000":return 1e3;case"1e6":return 1e6;case"1e9":return 1e9;default:return Math.floor(101*Math.random())}}function nextNumberQuestion(){const e=numMode.value,n=pickNumber(numRange.value),t=(numberToFinnishCardinal(n),numberToFinnishOrdinal(n));"digits-fi"===e?(numPrompt.textContent=String(n),numInput.value="",numFeedback.textContent="",numInput.placeholder="Finnish (e.g., nelj\xe4kymment\xe4seitsem\xe4n)",numCheck.onclick=()=>{const e=normFi(numInput.value)===normFi(numberToFinnishCardinal(n));numFeedback.innerHTML=e?'<div class="pill bg-green-100">Correct</div>':`<div class="pill bg-red-100">Answer: ${numberToFinnishCardinal(n)}</div>`,setTimeout(nextNumberQuestion,3e3)},numReveal.onclick=()=>{numInput.value=numberToFinnishCardinal(n)},numSpeak.onclick=()=>speak(numberToFinnishCardinal(n))):"fi-digits"===e?(numPrompt.textContent=numberToFinnishCardinal(n),numInput.value="",numFeedback.textContent="",numInput.placeholder="Digits (e.g., 47)",numCheck.onclick=()=>{const e=String(Number(numInput.value.trim()))===String(n);numFeedback.innerHTML=e?'<div class="pill bg-green-100">Correct</div>':`<div class="pill bg-red-100">Answer: ${n}</div>`,setTimeout(nextNumberQuestion,3e3)},numReveal.onclick=()=>{numInput.value=String(n)},numSpeak.onclick=()=>speak(numberToFinnishCardinal(n))):"digits-ord"===e?(numPrompt.textContent=String(n),numInput.value="",numFeedback.textContent="",numInput.placeholder="Finnish ordinal (e.g., kahdeskymmenes)",numCheck.onclick=()=>{const e=normFi(numInput.value)===normFi(t);numFeedback.innerHTML=e?'<div class="pill bg-green-100">Correct</div>':`<div class="pill bg-red-100">Answer: ${t}</div>`,setTimeout(nextNumberQuestion,3e3)},numReveal.onclick=()=>{numInput.value=t},numSpeak.onclick=()=>speak(t)):"ord-digits"===e&&(numPrompt.textContent=t,numInput.value="",numFeedback.textContent="",numInput.placeholder="Digits (e.g., 21)",numCheck.onclick=()=>{const e=Number(numInput.value.trim()),t=String(e)===String(n);numFeedback.innerHTML=t?'<div class="pill bg-green-100">Correct</div>':`<div class="pill bg-red-100">Answer: ${n}</div>`,setTimeout(nextNumberQuestion,3e3)},numReveal.onclick=()=>{numInput.value=String(n)},numSpeak.onclick=()=>speak(t))}function renderStudy(){const e=modeSelect.value,n=directionSelect.value;if(currentStudyCard=null,emptyState.classList.add("hidden"),suspendBtn&&(suspendBtn.disabled=!0,suspendBtn.textContent="Suspend",suspendBtn.title="Suspend current card"),[flashCard,mcq,type,conj,numbers].forEach(e=>e.classList.add("hidden")),"conj"===e){conj.classList.remove("hidden");const c=(DB.decks[currentDeckName]||[]).filter(e=>e.verb&&(e.conj||getBuiltInConj(e.fi)));if(conjRows.innerHTML="",conjFeedback.textContent="",0===c.length){conjVerbName.textContent="\u2014",conjMeaning.placeholder="Mark some cards as Verb and/or fill conjugations. Currently built-in: 'olla'.";const f=document.createElement("tr");return f.innerHTML='<td class="p-2 text-gray-600" colspan="3">No verbs with conjugations in this deck. Tick Verb when adding a card and fill forms (or use built\u2011in olla).</td>',conjRows.appendChild(f),conjCheck.onclick=()=>{conjFeedback.innerHTML='<div class="pill bg-yellow-100">Add a verb like "olla" and mark it as Verb, or provide conjugations in the add form.</div>'},void(conjReveal.onclick=()=>{})}const l=c[Math.floor(Math.random()*c.length)],d=l.fi,u=getBuiltInConj(d),m=l.conj?{meaning:l.conj.meaning||u?.meaning||"",pronouns:u?.pronouns||PRONOUNS,forms:{...u?.forms||{},...l.conj.forms||{}}}:u;if(conjVerbName.textContent=d,conjMeaning.value="",conjMeaning.placeholder="Type the English meaning",!m){const k=document.createElement("tr");return k.innerHTML='<td class="p-2 text-gray-600" colspan="3">No stored conjugations for this verb yet. Edit the card and fill the forms.</td>',conjRows.appendChild(k),conjCheck.onclick=()=>{conjFeedback.innerHTML='<div class="pill bg-yellow-100">Add conjugation forms to this verb card and try again.</div>'},void(conjReveal.onclick=()=>{conjFeedback.innerHTML='<div class="pill bg-yellow-100">No forms to reveal.</div>'})}const p=m.pronouns&&m.pronouns.length?m.pronouns:PRONOUNS;function t(e){return(e||"").trim().toLowerCase()}p.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`\n            <td class="p-2">${e}</td>\n            <td class="p-2"><input class="input w-full" data-pron="${e}" /></td>\n            <td class="p-2"><span class="text-xs" data-status="${e}"></span></td>\n          `,conjRows.appendChild(n)});const h=()=>setTimeout(()=>renderStudy(),3e3);return conjCheck.onclick=()=>{let e=!0;if(conjFeedback.innerHTML="",m.meaning){const n=t(conjMeaning.value)===t(m.meaning),r=document.createElement("div");r.className="text-xs mt-1",r.innerHTML=n?'<span class="pill bg-green-100">Meaning \u2713</span>':`<span class="pill bg-red-100">Meaning \u2192 ${m.meaning}</span>`,conjFeedback.appendChild(r),n||(e=!1)}p.forEach(n=>{const r=conj.querySelector(`input[data-pron="${n}"]`),s=conj.querySelector(`span[data-status="${n}"]`),a=m.forms?.[n]||"";t(r.value)===t(a)?s.innerHTML='<span class="pill bg-green-100">\u2713 correct</span>':(s.innerHTML=`<span class="pill bg-red-100">\u2192 ${a||"(n/a)"}</span>`,e=!1)}),conjFeedback.innerHTML+=e?'<div class="pill bg-green-100 mt-2">All correct! Next in 3s\u2026</div>':'<div class="pill bg-yellow-100 mt-2">Shown corrections. Next in 3s\u2026</div>',h()},void(conjReveal.onclick=()=>{p.forEach(e=>{const n=conj.querySelector(`input[data-pron="${e}"]`),t=conj.querySelector(`span[data-status="${e}"]`);n.value=m.forms?.[e]||"",t.innerHTML='<span class="pill bg-green-100">\u2713</span>'}),conjMeaning.value=m.meaning||"",conjFeedback.innerHTML='<div class="pill bg-blue-100">Filled with correct forms.</div>'})}if("numbers"===e)return numbers.classList.remove("hidden"),nextNumberQuestion(),numMode.onchange=nextNumberQuestion,numRange.onchange=nextNumberQuestion,void(suspendBtn&&(suspendBtn.disabled=!0));const r=pickCard();if(!r)return emptyState.classList.remove("hidden"),void(suspendBtn&&(suspendBtn.disabled=!0));const{idx:s,card:a}=r;currentStudyCard=r,suspendBtn&&(suspendBtn.disabled=!1,suspendBtn.textContent=a.suspended?"Resume":"Suspend",suspendBtn.title=a.suspended?"Resume this card":"Suspend this card");const i="fi-en"===n?a.fi:a.en,o="fi-en"===n?a.en:a.fi;if("flash"===e){flashCard.classList.remove("hidden"),fcLabel.textContent="fi-en"===n?"Finnish":"English",fcPrompt.textContent=i,fcAnswerWrap.classList.add("hidden"),fcAnswer.textContent=o;const v=a.example||a.hint;fcHint.textContent=v||"",revealBtn.onclick=()=>{fcAnswerWrap.classList.remove("hidden"),announce("Answer revealed")},speakBtn.onclick=speakCurrentCard,fcAnswerWrap.querySelectorAll("button[data-grade]").forEach(e=>{e.onclick=()=>gradeCurrentCard(e.dataset.grade)})}if("mcq"===e){mcq.classList.remove("hidden"),mcqLabel.textContent="fi-en"===n?"Finnish":"English",mcqPrompt.textContent=i,mcqOptions.innerHTML="",mcqFeedback.textContent="";const g=DB.decks[currentDeckName].map(e=>"fi-en"===n?e.en:e.fi).filter(e=>e&&e!==o),y=Math.min(3,g.length),b=new Set;for(;b.size<y;)b.add(g[Math.floor(Math.random()*g.length)]);const C=[o,...b];C.sort(()=>Math.random()-.5);let D=!1;C.forEach(e=>{const n=el("button","btn w-full text-left",e);n.onclick=()=>{if(D)return;D=!0;const n=e===o;mcqFeedback.innerHTML=n?'<div class="pill bg-green-100">Correct!</div>':`<div class="pill bg-red-100">Correct answer: ${o}</div>`,announce(n?"Correct answer":`Incorrect. Correct answer is ${o}`),recordReview(n?"good":"again"),saveDB(),renderProgress(),setTimeout(()=>renderStudy(),600)},mcqOptions.appendChild(n)})}if("type"===e){type.classList.remove("hidden"),typeLabel.textContent="fi-en"===n?"Finnish":"English",typePrompt.textContent=i,typeInput.value="",typeFeedback.textContent="",typeInput.focus();const S=e=>(e||"").trim().replace(/[.!?\u2026,:;]+$/u,"").toLowerCase(),B=e=>{typeFeedback.innerHTML=e?'<div class="pill bg-green-100">Correct</div>':`<div class="pill bg-red-100">Answer: ${o}</div>`,announce(e?"Correct answer":`Incorrect. Correct answer is ${o}`)};let $=!1;typeCheckBtn.onclick=()=>{const e=S(typeInput.value)===S(o);B(e),$||($=!0,recordReview(e?"good":"again"),saveDB(),renderProgress())},typeInput.onkeydown=e=>{"Enter"===e.key&&typeCheckBtn.click()}}}function runSelfTests(){const e=document.getElementById("testStatus"),n=[],t=PRONOUNS,r={"min\xe4":"olen","sin\xe4":"olet","h\xe4n/se":"on",me:"olemme",te:"olette","he/ne":"ovat"};try{const e=(e,r,s=!1)=>{const a=getBuiltInConj(e);a&&(s&&JSON.stringify(a.pronouns)!==JSON.stringify(t)&&n.push(`${e}: pronouns mismatch`),Object.entries(r).forEach(([t,r])=>{a.forms?.[t]!==r&&n.push(`Form mismatch for ${e} (${t})`)}))};e("olla",r,!0),e("her\xe4t\xe4",{"min\xe4":"her\xe4\xe4n",te:"her\xe4\xe4tte"}),e("nousta",{"sin\xe4":"nouset","he/ne":"nousevat"}),e("l\xe4hte\xe4",{"h\xe4n/se":"l\xe4htee",me:"l\xe4hdemme"}),e("opiskella",{"min\xe4":"opiskelen",te:"opiskelette"}),e("ty\xf6skennell\xe4",{"sin\xe4":"ty\xf6skentelet","he/ne":"ty\xf6skentelev\xe4t"}),e("lev\xe4t\xe4",{me:"lep\xe4\xe4mme",te:"lep\xe4\xe4tte"}),"nelj\xe4kymment\xe4seitsem\xe4n"!==numberToFinnishCardinal(47)&&n.push("47 \u2192 nelj\xe4kymment\xe4seitsem\xe4n"),"kahdeksankymment\xe4kolme"!==numberToFinnishCardinal(83)&&n.push("83 \u2192 kahdeksankymment\xe4kolme"),"sata"!==numberToFinnishCardinal(100)&&n.push("100 \u2192 sata"),"kaksisataa"!==numberToFinnishCardinal(200)&&n.push("200 \u2192 kaksisataa"),"kaksisataakolmekymment\xe4nelj\xe4"!==numberToFinnishCardinal(234)&&n.push("234 \u2192 kaksisataakolmekymment\xe4nelj\xe4"),"nolla"!==numberToFinnishCardinal(0)&&n.push("0 \u2192 nolla")}catch(e){n.push("Exception in tests: "+e.message)}0===n.length?(e&&(e.textContent="Self\u2011check: OK",e.classList.add("bg-green-100")),console.log("[Self-test] All good")):(e&&(e.textContent="Self\u2011check: "+n.length+" issue(s)",e.classList.add("bg-yellow-100")),console.warn("[Self-test] Failures:",n))}function buildVerbEditorDefaults(){const e=()=>{isVerb.checked&&prefillVerbEditor()};finnishInput.addEventListener("change",e),finnishInput.addEventListener("blur",e)}const PRONOUNS=["min\xe4","sin\xe4","h\xe4n/se","me","te","he/ne"],defaultDecks=()=>({"User List":[{fi:"N\xe4kemiin",en:"goodbye (polite/formal)",hint:"Kiitos, n\xe4kemiin.",phrase:!0},{fi:"Hyv\xe4\xe4 p\xe4iv\xe4njatkoa",en:"have a nice rest of the day",hint:"Shop/office leave-taking.",phrase:!0},{fi:"toissap\xe4iv\xe4n\xe4",en:"the day before yesterday",hint:"Toissap\xe4iv\xe4n\xe4 satoi.",phrase:!0},{fi:"eilen",en:"yesterday",hint:"Eilen oli kylm\xe4.",phrase:!0},{fi:"t\xe4n\xe4\xe4n",en:"today",hint:"T\xe4n\xe4\xe4n on tiistai.",phrase:!0},{fi:"huomenna",en:"tomorrow",hint:"Huomenna menen t\xf6ihin.",phrase:!0},{fi:"ylihuomenna",en:"the day after tomorrow",hint:"Ylihuomenna on torstai.",phrase:!0}]}),DB_KEY="fi_trainer_v1",loadDB=()=>{try{return JSON.parse(localStorage.getItem(DB_KEY))||{decks:defaultDecks(),stats:{}}}catch{return{decks:defaultDecks(),stats:{}}}},saveDB=()=>localStorage.setItem(DB_KEY,JSON.stringify(DB));let DB=loadDB();ensureHistory();const $=e=>document.querySelector(e),el=(e,n,t)=>{const r=document.createElement(e);return n&&(r.className=n),t&&(r.textContent=t),r},deckSelect=$("#deckSelect"),cardCount=$("#cardCount"),dueCount=$("#dueCount"),newCount=$("#newCount"),reviewCount=$("#reviewCount"),learnedCount=$("#learnedCount"),cardList=$("#cardList"),addCardBtn=$("#addCardBtn"),finnishInput=$("#finnishInput"),englishInput=$("#englishInput"),hintInput=$("#hintInput"),isPhrase=$("#isPhrase"),isVerb=$("#isVerb"),verbEditor=$("#verbEditor"),verbMeaningInput=$("#verbMeaningInput"),verbFormsBody=$("#verbFormsBody"),exportBtn=$("#exportBtn"),importFile=$("#importFile"),newDeckBtn=$("#newDeckBtn"),delDeckBtn=$("#delDeckBtn"),infoButton=$("#infoButton"),infoOverlay=$("#infoOverlay"),infoPanel=$("#infoPanel"),infoClose=$("#infoClose"),modeSelect=$("#modeSelect"),directionSelect=$("#directionSelect"),shuffleBtn=$("#shuffleBtn"),subsetSelect=$("#subsetSelect"),suspendBtn=$("#suspendBtn"),flashCard=$("#flashCard"),fcLabel=$("#fcLabel"),fcPrompt=$("#fcPrompt"),revealBtn=$("#revealBtn"),speakBtn=$("#speakBtn"),fcAnswerWrap=$("#fcAnswerWrap"),fcAnswer=$("#fcAnswer"),fcHint=$("#fcHint"),mcq=$("#mcq"),mcqLabel=$("#mcqLabel"),mcqPrompt=$("#mcqPrompt"),mcqOptions=$("#mcqOptions"),mcqFeedback=$("#mcqFeedback"),type=$("#type"),typeLabel=$("#typeLabel"),typePrompt=$("#typePrompt"),typeInput=$("#typeInput"),typeCheckBtn=$("#typeCheckBtn"),typeFeedback=$("#typeFeedback"),conj=$("#conj"),conjVerbName=$("#conjVerbName"),conjMeaning=$("#conjMeaning"),conjRows=$("#conjRows"),conjCheck=$("#conjCheck"),conjReveal=$("#conjReveal"),conjFeedback=$("#conjFeedback"),numbers=$("#numbers"),numMode=$("#numMode"),numRange=$("#numRange"),numPrompt=$("#numPrompt"),numInput=$("#numInput"),numCheck=$("#numCheck"),numReveal=$("#numReveal"),numFeedback=$("#numFeedback"),numSpeak=$("#numSpeak"),emptyState=$("#emptyState"),reviewsToday=$("#reviewsToday"),accuracyToday=$("#accuracyToday"),longestStreak=$("#longestStreak"),progressChart=$("#progressChart"),liveRegion=$("#liveRegion");suspendBtn&&(suspendBtn.disabled=!0);let currentDeckName=Object.keys(DB.decks)[0],currentOrder=[],currentIndex=0,currentStudyCard=null;const CONJ={},clearConjugations=()=>{Object.keys(CONJ).forEach(e=>delete CONJ[e])},registerConjugation=(e,n)=>{if(!e||!n||!n.forms)return;const t=e.trim().toLowerCase(),r=Array.isArray(n.pronouns)&&n.pronouns.length?n.pronouns:PRONOUNS,s={...n.forms};CONJ[t]={meaning:n.meaning||"",pronouns:r,forms:s}},rebuildConjugations=()=>{clearConjugations(),Object.values(DB.decks||{}).forEach(e=>{(e||[]).forEach(e=>{e?.verb&&e?.conj?.forms&&registerConjugation(e.fi,e.conj)})})},getBuiltInConj=e=>CONJ[(e||"").trim().toLowerCase()],ONES=["nolla","yksi","kaksi","kolme","nelj\xe4","viisi","kuusi","seitsem\xe4n","kahdeksan","yhdeks\xe4n"],TEENS=["kymmenen","yksitoista","kaksitoista","kolmetoista","nelj\xe4toista","viisitoista","kuusitoista","seitsem\xe4ntoista","kahdeksantoista","yhdeks\xe4ntoista"],TENS=[null,null,"kaksikymment\xe4","kolmekymment\xe4","nelj\xe4kymment\xe4","viisikymment\xe4","kuusikymment\xe4","seitsem\xe4nkymment\xe4","kahdeksankymment\xe4","yhdeks\xe4nkymment\xe4"],HUNDRED="sata",ORD_BASE={1:"ensimm\xe4inen",2:"toinen",3:"kolmas",4:"nelj\xe4s",5:"viides",6:"kuudes",7:"seitsem\xe4s",8:"kahdeksas",9:"yhdeks\xe4s",10:"kymmenes"},normFi=e=>(e||"").toLowerCase().replace(/[\s-]+/g,"");buildVerbEditorRows(),isVerb.onchange=()=>{const e=isVerb.checked;verbEditor.classList.toggle("hidden",!e),e&&prefillVerbEditor()},addCardBtn.onclick=()=>{const e=finnishInput.value.trim(),n=englishInput.value.trim();if(!e||!n)return alert("Please fill Finnish and English");let t=null;if(isVerb.checked){const n=(verbMeaningInput.value||"").trim(),r={};PRONOUNS.forEach(e=>{r[e]=(document.querySelector(`[data-vform="${e}"]`).value||"").trim()});const s=n||Object.values(r).some(e=>e),a=getBuiltInConj(e);!s&&a||(t={meaning:n||a?.meaning||"",forms:r})}const r=hintInput.value.trim(),s={fi:e,en:n,hint:r,phrase:!!isPhrase.checked,verb:!!isVerb.checked,suspended:!1};s.phrase&&r&&(s.example=r),t&&(s.conj=t),DB.decks[currentDeckName]=DB.decks[currentDeckName]||[],DB.decks[currentDeckName].push(s),saveDB(),finnishInput.value=englishInput.value=hintInput.value="",isPhrase.checked=!1,isVerb.checked=!1,verbMeaningInput.value="",PRONOUNS.forEach(e=>{const n=document.querySelector(`[data-vform="${e}"]`);n&&(n.value="")}),verbEditor.classList.add("hidden"),renderCardList(),refreshCounts(),reshuffle(),renderStudy()},deckSelect.onchange=e=>{currentDeckName=e.target.value,refreshDecks()},newDeckBtn.onclick=()=>{const e=(prompt("New deck name:")||"").trim();if(e){if(DB.decks[e])return alert("Deck already exists");DB.decks[e]=[],currentDeckName=e,saveDB(),refreshDecks()}},delDeckBtn.onclick=()=>{confirm(`Delete deck "${currentDeckName}"?`)&&(delete DB.decks[currentDeckName],currentDeckName=Object.keys(DB.decks)[0]||"My Deck",DB.decks[currentDeckName]||(DB.decks[currentDeckName]=[]),saveDB(),refreshDecks())},exportBtn.onclick=()=>{const e=new Blob([JSON.stringify(DB,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download="finnish_trainer_backup.json",n.click()},importFile.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.text(),t=JSON.parse(e);if(!t.decks)throw new Error("Invalid file");DB=t,normalizeAllDecks(),saveDB(),refreshDecks()}catch(e){alert("Import failed: "+e.message)}};const DAY_MS=864e5,dayKey=(e=new Date)=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,parseDay=e=>{const[n,t,r]=e.split("-").map(Number);return new Date(n,t-1,r)},diffInDays=(e,n)=>Math.round((n.getTime()-e.getTime())/DAY_MS),hideInfo=()=>{infoOverlay&&!infoOverlay.classList.contains("hidden")&&(infoOverlay.classList.add("hidden"),infoButton&&infoButton.setAttribute("aria-expanded","false"))},showInfo=()=>{infoOverlay&&infoOverlay.classList.contains("hidden")&&(infoOverlay.classList.remove("hidden"),infoButton&&infoButton.setAttribute("aria-expanded","true"),announce("Usage information opened"),infoPanel&&requestAnimationFrame(()=>infoPanel.focus()))};infoButton&&infoOverlay&&infoPanel&&(infoButton.addEventListener("click",e=>{e.stopPropagation(),infoOverlay.classList.contains("hidden")?showInfo():hideInfo()}),infoOverlay.addEventListener("click",e=>{e.target===infoOverlay&&hideInfo()}),infoClose&&infoClose.addEventListener("click",hideInfo),document.addEventListener("click",e=>{infoOverlay.classList.contains("hidden")||infoPanel.contains(e.target)||e.target===infoButton||hideInfo()}),document.addEventListener("keydown",e=>{"Escape"!==e.key||infoOverlay.classList.contains("hidden")||hideInfo()})),modeSelect.onchange=()=>{renderStudy(),announce(`Study mode set to ${modeSelect.options[modeSelect.selectedIndex].text}`)},directionSelect.onchange=()=>{renderStudy(),announce(`Direction set to ${directionSelect.options[directionSelect.selectedIndex].text}`)},subsetSelect.onchange=()=>{reshuffle(),renderStudy(),announce(`Subset set to ${subsetSelect.options[subsetSelect.selectedIndex].text}`)},shuffleBtn.onclick=()=>{reshuffle(),renderStudy(),announce("Cards shuffled")},suspendBtn.onclick=toggleSuspendCurrent,document.addEventListener("keydown",e=>{const n=e.target.tagName;if("INPUT"===n||"TEXTAREA"===n||e.target.isContentEditable)return;const t=modeSelect.value;if(" "===e.key&&"flash"===t&&(e.preventDefault(),fcAnswerWrap.classList.contains("hidden")?revealBtn.click():gradeCurrentCard("good")),["1","2","3","4"].includes(e.key)&&"flash"===t){e.preventDefault();gradeCurrentCard({1:"again",2:"hard",3:"good",4:"easy"}[e.key])}"s"===e.key.toLowerCase()&&(e.preventDefault(),speakCurrentCard())}),buildVerbEditorRows(),buildVerbEditorDefaults(),normalizeAllDecks(),refreshDecks(),runSelfTests();</script> </body> </html>